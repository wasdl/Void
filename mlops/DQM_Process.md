# 정수기 데이터 DQM(Data Quality Management) 프로세스

## 1. 모델 평가 지표
- **R2 Score**: 모델의 설명력 지표
- **RMSE**: 예측 오차 지표
- **정확도**: |실제값-예측값|/실제값 < 0.1 비율

## 2. 데이터 전처리 및 분석

### 2.1 DBSCAN 군집화
- **기본 파라미터**: eps=0.9, min_samples=3
- **평가 기준**:
  - 실루엣 점수 ≥ 0.6
  - 남은 사용자 비율 ≤ 5% 또는 500명 이하

### 2.2 DTW+IQR 이상치 제거
- **처리 방식**: DTW 거리 계산 후 IQR 방식으로 이상치 식별
- **기본 파라미터**: Q1=25%, Q3=75%
- **이상치 계산**: 상한 경계 = Q3 + 0.5 * IQR

### 2.3 오토인코더 기반 패턴 학습
- **임계값 설정**: Mean(MSE) + 1.5 * Std(MSE)
- **Unknown 패턴 기준**: 모든 군집의 재구성 오차가 임계값 초과

## 3. 특성 공학 및 평가
- **VIF 평가**: 15 이상 시 PCA 적용
- **특성 중요도**: 0.5% 미만 특성 제거
- **모델 성능 목표**: R2 Score > 0.5, RMSE < 30

## 4. ML 모델링 파이프라인

### 4.1 기본 모델링 프로세스
```
A. DBSCAN 군집화
   ↓
   [검증] 실루엣 계수 ≥ 0.6 AND 사용자 수 ≥ 500명(또는 10%)
   ↓                      ↑
   [실패] → eps 조정(0.3~1.5 범위) 또는 처리 중단
   ↓
B. 오토인코더 학습
   ↓
   [검증] Unknown 사용자 비율 ≤ 5%
   ↓                      ↑
   [실패] → 임계값 조정(Mean+1.5*Std → Mean+2.0*Std) 또는 A로 돌아감
   ↓
C. XGBoost ALL 타입 모델 학습
   ↓
   [검증] R2 Score ≥ 0.6
   ↓                ↑
   [실패] → A로 돌아가 DBSCAN 파라미터 재조정
   ↓
D. XGBoost 타입별 모델 학습
   ↓
   [검증] 정확도 ≥ 60%
   ↓                ↑
   [실패] → B로 돌아가 오토인코더 임계값 재조정
```

## 5. 자동 재학습 프로세스

### 5.1 미할당 사용자 프로세스
```
A. DBSCAN 재군집화
   ↓
   [검증] 실루엣 계수 ≥ 0.6 AND 사용자 수 ≥ 500명(또는 10%)
   ↓                      ↑
   [실패] → eps 조정(0.3~1.5 범위) 또는 처리 중단
   ↓
B. 신규 오토인코더 학습
   ↓
   [검증] Unknown 사용자 비율 ≤ 5%
   ↓                      ↑
   [실패] → 임계값 조정 또는 A로 돌아감
   ↓
C. 신규 XGBoost ALL 타입 모델
   ↓
   [검증] R2 Score ≥ 0.6
   ↓                ↑
   [실패] → A로 돌아가 DBSCAN 파라미터 재조정
   ↓
D. 신규 XGBoost 타입별 모델
   ↓
   [검증] 정확도 ≥ 60%
   ↓                ↑
   [실패] → B로 돌아가 오토인코더 임계값 재조정
```

### 5.2 기존 할당 사용자 프로세스
```
1. 개인 기반 모델 학습 (XGBoost)
   ↓
   [검증] 정확도 ≥ 60%
   ↓                ↑
   [실패] → 하이퍼파라미터 조정(learning_rate, max_depth, n_estimators)
   ↓
2. 파운데이션 모델 + 개인 모델 앙상블
   ↓
   [검증] 개인 모델 대비 5% 이상 성능 향상
   ↓                                 ↑
   [실패] → 앙상블 가중치 자동 조정(α값 0.1~0.9 범위) 또는 파운데이션 모델만 사용
   ↓
3. 성능 비교 및 최적 모델 선택
```

## 6. 모델 관리 및 적용

### 6.1 모델 버전 관리
- 7일 주기 모델 업데이트
- 버전 형식: [사용자ID]_[군집ID]_[생성날짜]_v[버전번호]
- 성능 저하 시 롤백 메커니즘
  - 2% 이상 성능 하락 시 이전 버전으로 자동 롤백
  - 14일 연속 성능 저하 시 전체 파이프라인 재실행

### 6.2 모델 적용 및 활용
- 신규 사용자 군집 할당
- 출수량 예측 및 이상 패턴 감지
- 개인화 모델 점진적 적용 
